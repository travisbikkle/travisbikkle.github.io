<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux on 奇风岁月</title><link>https://travisbikkle.github.io/zh-hant/linux/</link><description>Recent content in Linux on 奇风岁月</description><generator>Hugo -- gohugo.io</generator><language>zh-hant</language><lastBuildDate>Thu, 20 Jun 2024 15:38:19 +0000</lastBuildDate><atom:link href="https://travisbikkle.github.io/zh-hant/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>TP-LINK WAR-2600L 路由器 DMZ 功能分析</title><link>https://travisbikkle.github.io/zh-hant/2024/06/tplink-war2600l-iptables/</link><pubDate>Thu, 20 Jun 2024 15:38:19 +0000</pubDate><guid>https://travisbikkle.github.io/zh-hant/2024/06/tplink-war2600l-iptables/</guid><description>問題 硬件型號 TL-WAR2600L v2.0 企業路由器 固件版本 1.0.1 Build 20180313 Rel.37492 本地150自提了這個路由器，準備用它的多 wan 口搞搞事情，但是沒想到掉坑裏了：
80, 443 端口使用寬帶撥號的外網 ip 可以訪問（不安全） 1在局域網內輸入外網寬帶 ip，可以訪問路由器管理界面； 2但是在真正的外網上，比如手機不連局域網，訪問寬帶 ip，實際上又不能訪問（我的 ip 是公網 ip）。 虛擬服務器轉發的端口，從外網無法基本全部不可用 分析過程 獲取 ssh 端口號和密碼，登錄到路由器後臺 系統工具-設備管理-備份與導入設置，導出一個 bin 文件。使用 7z 打開，查看如下路徑 \backup-TP-LINK-2024-06-20\tmp\userconfig\etc\config\dropbear 1config dropbear 2 option PasswordAuth &amp;#39;on&amp;#39; 3 option RootPasswordAuth &amp;#39;on&amp;#39; 4 option Port &amp;#39;33400&amp;#39; # 這個就是端口 5 option ssh_port_switch &amp;#39;on&amp;#39; 在路由器管理頁面 基本設置 - LAN設置 中獲取 mac 地址，然後找一個 linux 命令行工具執行 1## xx-xx-xx-xx-xx-xx 是你找到的 mac 地址。注意 -n 2echo -n &amp;#34;xx-xx-xx-xx-xx-xx&amp;#34;|sed &amp;#34;s/-//g&amp;#34;|md5sum|cut -c 1-8 3xxxxxxxx # 8位密碼 登錄後我其實還沒發現（因爲我不折騰 openwrt，有羣暉和一臺2U機架服務器了，路由器我只追求穩定）， 這個路由器用的是 openwrt barrier breaker（龍媽：我是 chain breaker） 14.</description></item><item><title>Vmware 死機但是鼠標可以動</title><link>https://travisbikkle.github.io/zh-hant/2024/03/vmware-freeze/</link><pubDate>Wed, 06 Mar 2024 17:09:19 +0000</pubDate><guid>https://travisbikkle.github.io/zh-hant/2024/03/vmware-freeze/</guid><description>問題現象 宿主機 Win11 客戶機 Kubuntu 22.04 vmware vmware workstation pro 17.5 在使用 VSCode 的時候，我的客戶機總是沒有規律的死機，這個時候鼠標可以移動，但是無法點擊。能看出來客戶機並沒有真正的死機。我曾經監控過 /var/log 下面的日誌，以及用 top 監控過系統資源情況，但是沒能發現任何異常。後來在宿主機的虛擬機目錄 vmware.log 中，看到如下一行日誌，才明白髮生了什麼：
12024-03-06T16:33:01.365Z In(05) mks VMMouse: Dropping move received while input queue was full 這是最後一行日誌，非常好發現。這說明客戶機不再接收任何輸入，難怪表現爲好像死機了！
解決方案 我搜索了這個報錯，在 vmware 社區很多年前的一篇文章中找到了如下方法。
config.ini 的位置可能因操作系統不同而不同，請自行搜索位置。 config.ini 修改後保存時可能沒有權限，可以先另存到桌面，然後拖動到原位置。 vmx文件在修改後可能發生錯誤，請先備份該文件。 在 C:\ProgramData\VMware\VMware Workstation\config.ini 添加以下兩行 1prefvmx.useRecommendedLockedMemSize = &amp;#34;TRUE&amp;#34; 2prefvmx.minVmMemPct = &amp;#34;100&amp;#34; 一些遇到鼠標或者鍵盤一直輸入問題，例如 characterrrrrrrrr，可能還需要添加如下兩行（未經驗證） 1mks.disableTypematic = &amp;#34;TRUE&amp;#34; 2mks.disableRemoteClientTypematic = &amp;#34;TRUE&amp;#34; 修改 xxxx.vmx（該文件存在於你的客戶機根目錄，請將 xxxx.vmx 替換爲實際名稱） 1sched.mem.pshare.enable = &amp;#34;FALSE&amp;#34; 2mainMem.useNamedFile = &amp;#34;FALSE&amp;#34; 3MemTrimRate = &amp;#34;0&amp;#34; 4MemAllowAutoScaleDown = &amp;#34;FALSE&amp;#34; 如果問題仍然沒有解決，可以降級到 17.</description></item><item><title>Termux 常用命令</title><link>https://travisbikkle.github.io/zh-hant/2024/01/termux-useful-command/</link><pubDate>Sat, 27 Jan 2024 16:29:16 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2024/01/termux-useful-command/</guid><description>常用的內置的 termux 命令 輸入 termux 並按 Tab 提示，控制檯會顯示一些 termux 開頭的命令。 下面是一些最常用命令，如更換軟件源或者在手機內拷貝文件：
1# 更換軟件源 2termux-change-repo 3# 開啓存儲權限 4termux-setup-storage 5# 保持常亮 6termux-wake-lock 從手機複製文件 1# 開啓存儲權限 2termux-setup-storage 3# 執行後重新啓動 termux，然後輸入 4ln -s /sdcard/Download ~/download 5# 或者有些手機是 6ln -s /sdcard/Downloads ~/download 定時任務 1# 保持常亮 2termux-wake-lock 3# 安裝並啓動 crond 4apt install cronie 5crond 6# 增加一個定時任務 7crontab -e 8# 手動輸入或使用 https://crontab-generator.org/ 生成一個，例如 91 * * * * bash ~/download/update_domain.sh &amp;gt; ~/download/update.log 10# 按 ctrl o 保存， ctrl x 退出</description></item><item><title>Vmware 中 Intellij Idea 快捷鍵錯誤</title><link>https://travisbikkle.github.io/zh-hant/2023/12/idea-shortkey-error-in-vmware/</link><pubDate>Fri, 01 Dec 2023 11:24:32 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/12/idea-shortkey-error-in-vmware/</guid><description>在VMware中，CTRL ALT是默認的將鼠標焦點從虛擬機中移開的熱鍵，這將導致一切在Vmware中運行的虛擬機系統中以該組合鍵 位開頭的熱鍵不可用。比如Intellij Idea的默認後退快捷鍵CTRL ALT LEFT。
一開始我以爲是KDE熱鍵衝突的問題，因爲KDE默認有很多的快捷鍵，但是經過查看KDE的系統設置，並沒有發現熱鍵佔用的情況：
直到我意識到screenkey也沒有提示，這說明我的KDE根本沒有接收到CTRL ALT LEFT按鍵。答案顯而易見，是Vmware的問題了。 爲了防止衝突，在Vmware的 編輯-首選項-熱鍵 中可以將這四個按鍵都勾選上。</description></item><item><title>Vmware Power-ON 腳本啓動失敗</title><link>https://travisbikkle.github.io/zh-hant/2023/11/vmware-poweron-script/</link><pubDate>Thu, 16 Nov 2023 11:24:33 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/11/vmware-poweron-script/</guid><description>VMware 的開機腳本位於 /etc/vmware-tools/ 下。如果你的虛擬機報錯啓動客戶機腳本失敗，你可以在虛擬機-電源-開機中開機，然後進入該目錄調試。
如果你的vmware-tools進行過升級，但是升級過程中出現了問題，可能導致腳本沒有正確命名。比如，下面是開機、關機等操作對應的腳本名稱
1poweroff-vm-default 2poweron-vm-default 3resume-vm-default 4suspend-vm-default 5vgauth.conf 而你的機器上可能是
1poweroff-vm-default.dpkg-dist 2poweron-vm-default.dpkg-dist 3resume-vm-default.dpkg-dist 4suspend-vm-default.dpkg-dist 5vgauth.conf.dpkg-dist 那麼請執行以下命令重命名即可
1find /etc/vmware-tools/ -name &amp;#34;*.dpkg-dist&amp;#34; -exec sh -c &amp;#39;x={}; cp &amp;#34;$x&amp;#34; $(echo $x | sed &amp;#39;s/\.dpkg-dist//g&amp;#39;)&amp;#39; \; 另外你還可能需要檢查 /etc/vmware-tools/scripts/vmware 以及各個腳本是否具有可執行權限。</description></item><item><title>Kubuntu Vscode 鼠標列編輯設置</title><link>https://travisbikkle.github.io/zh-hant/2023/11/kubuntu-vscode-mouse/</link><pubDate>Wed, 15 Nov 2023 11:24:33 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/11/kubuntu-vscode-mouse/</guid><description>鼠標中鍵是某些操作系統的默認粘貼快捷鍵，這導致在VSCode中無法使用鼠標中鍵進入列編輯模式。
點擊 文件-首選項-設置 點擊右上角，打開json文件 添加如下行
1&amp;#34;editor.selectionClipboard&amp;#34;: false 關閉 VSCode 並重新打開，測試是否生效。</description></item><item><title>Android Studio Emulator 啓動失敗</title><link>https://travisbikkle.github.io/zh-hant/2023/11/android-studio-emulator-failed/</link><pubDate>Wed, 15 Nov 2023 11:24:23 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/11/android-studio-emulator-failed/</guid><description>報錯現象 The emulator process for AVD Pixel_3a_API_34_extension_level_7_x86_64 has terminated.
沒有任何的報錯信息，如果不知道日誌在哪裏，該如何排查呢？
解決辦法 在你的家目錄如下位置，執行如下命令，通過命令行查詢出虛擬設備並啓動，將報錯信息打印到前臺
1yourname@v:~/Android/Sdk/emulator$ ./emulator -list-avds 2Pixel_3a_API_34_extension_level_7_x86_64 3yourname@v:~/Android/Sdk/emulator$ ./emulator @Pixel_3a_API_34_extension_level_7_x86_64 4INFO | Android emulator version 32.1.15.0 (build_id 10696886) (CL:N/A) 5INFO | Found systemPath /home/yourname/Android/Sdk/system-images/android-34/google_apis/x86_64/ 6INFO | Storing crashdata in: /tmp/android-yourname/emu-crash.db, detection is enabled 7INFO | Duplicate loglines will be removed, if you wish to see each indiviudal line launch with the -log-nofilter flag. 8WARNING | Please update the emulator to one that supports the feature(s): SupportPixelFold 9ERROR | Not enough space to create userdata partition.</description></item><item><title>Intellij Idea 啓動報錯</title><link>https://travisbikkle.github.io/zh-hant/2023/11/idea-start-error/</link><pubDate>Tue, 14 Nov 2023 11:24:23 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/11/idea-start-error/</guid><description>Intellij Idea 2023.2 啓動報錯：
Error while opening intellij &amp;ldquo;Cannot connect to already running IDE instance. Exception: Process 2,837 is still running&amp;rdquo;
youtrack 跟蹤 https://youtrack.jetbrains.com/issue/IDEA-330531
解決辦法 在菜單中編輯啓動項，在idea.sh前加入一個前置的腳本，在其中刪除不該存在的.lock文件
1/opt/idea-IU-232.10203.10/bin/prestart.sh; /opt/idea-IU-232.10203.10/bin/idea.sh 腳本的內容爲
1#!/bin/bash 2rm ~/.config/JetBrains/IntelliJIdea2023.2/.lock</description></item><item><title>Kubuntu 軟件源在哪裏修改</title><link>https://travisbikkle.github.io/zh-hant/2023/11/kubuntu2204-software-resources-bug/</link><pubDate>Wed, 08 Nov 2023 11:24:30 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/11/kubuntu2204-software-resources-bug/</guid><description>Kubuntu 22.04 的軟件源可以在 Discover 中的如下位置設置。 但是如果你的 Discover 不顯示以上界面，可以通過如下方法來修復。
編輯如下文件
1vi /usr/share/applications/software-properties-qt.desktop 將以下內容替換到源文件
1[Desktop Entry] 2Name=Software Sources 3GenericName=Software Sources 4Comment=Configure the sources for installable software and updates 5Exec=pkexec env DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY software-properties-qt 6Icon=applications-other 7NoDisplay=false 8Terminal=false 9X-MultipleArgs=false 10Type=Application 11Categories=System;Settings; 12MimeType=text/x-apt-sources-list; 13X-KDE-SubstituteUID=false 14X-Ubuntu-Gettext-Domain=software-properties 如此，在 Discover可以顯示軟件源的界面，在菜單中也可以搜索到在其它發行版中常見的 軟件源 菜單項。</description></item><item><title>Kubuntu 22.04 中文輸入法</title><link>https://travisbikkle.github.io/zh-hant/2023/11/kubuntu2204-chiness-im/</link><pubDate>Wed, 08 Nov 2023 11:24:29 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/11/kubuntu2204-chiness-im/</guid><description>繼續使用 fcitx5（推薦） 安裝 fcitx5 中文輸入法
1sudo apt install fcitx5-chinese-addons \ 2fcitx5-frontend-gtk4 fcitx5-frontend-gtk3 fcitx5-frontend-gtk2 \ 3fcitx5-frontend-qt5 $(check-language-support) check-language-support 同時安裝了系統中缺失的中文語言包（在 區域設置-語言 中點擊安裝缺失的語言包沒有反應），這樣才能在第3步中看到 輸入法 的選項。
啓用 fcitx5 注意，不要相信網上任何要你更改.xinputrc或者在某些文件中添加如下變量的話
GTK_IM_MODULE=fcitx
QT_IM_MODULE=fcitx
XMODIFIERS=@im=fcitx
請直接使用你登錄的用戶執行以下命令
1im-config 在彈出的窗口中，依次選擇確定，是，選擇如下選項即可。 重啓系統 在 系統設置-區域設置-輸入法 中添加 拼音 或者 pinyin
解決 Intellij Idea 中使用 fcitx5 候選框不跟隨的問題 (20240126更新：此時的Idea已經沒有此問題，無需進行此步) 可以將如下項目的release文件解壓縮到JetBrain產品的jbr目錄中（可能導致markdown無法預覽）
1https://github.com/RikudouPatrickstar/JetBrainsRuntime-for-Linux-x64 程序員推薦在如下配置中關閉簡繁切換快捷鍵
系統設置-區域設置-輸入法-配置附加組件-簡繁切換 中刪除CTRL SHIFT F的簡繁切換快捷鍵。
解決在 Visual Studio Code 中無法使用任何中文輸入法的問題
如果你在 Discover 軟件管理工具中下載了 VSCode，請卸載後，在官網下載 deb 包安裝，即可解決無法輸入中文的問題。
使用 fcitx4 卸載 fcitx5
1sudo apt-get remove fcitx5 安裝谷歌拼音輸入法</description></item><item><title>Ubuntu 改鍵</title><link>https://travisbikkle.github.io/zh-hant/2023/10/remaps-keys-in-ubuntu/</link><pubDate>Tue, 17 Oct 2023 11:24:32 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/10/remaps-keys-in-ubuntu/</guid><description>在 Ubuntu Software 中搜索 Gnome Tweaks 並安裝。 點擊 Keyboard &amp;amp; Mouse 點擊 Additional Layout Options 在彈出的窗口中，勾選 Ctrl position 中的 Swap Ctrl and Caps Lock 本文基於 Ubuntu 22.04 LTS 及 Gnome Tweaks 3.34.0 編寫。
補充：使用kde更加的方便，該設置已經被集成到系統設置中，無需下載 Gnome Tweaks。</description></item><item><title>Code Server Nginx Ssl Error</title><link>https://travisbikkle.github.io/zh-hant/2023/10/code-server-nginx-ssl-error-1006/</link><pubDate>Tue, 17 Oct 2023 11:24:30 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/10/code-server-nginx-ssl-error-1006/</guid><description>1An unexpected error occurred that requires a reload of this page. 2The workbench failed to connect to the server (Error: WebSocket close with status code 1006) Code server popped up a websocket error when I exposed code-server using a custom domain and a custom port via nginx.
Here is part of my nginx.conf.
1 upstream code{ 2 server xxxxxxxxx; 3 } 4 server { 5 listen 40032 ssl; 6 server_name xxxxxxxx; 7 ssl_certificate certs/mycert.</description></item><item><title>How to add samba entry in /etc/fstab</title><link>https://travisbikkle.github.io/zh-hant/2023/10/fatab-samba/</link><pubDate>Tue, 17 Oct 2023 11:24:29 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/10/fatab-samba/</guid><description>Configure Samba On Ubuntu
1. install necessary tools 1sudo apt install cifs-utils 2. prepare credentials 1sudo mkdir /mnt/samba 2sudo vi /root/.smb_credentials 3. put next 2 lines into /root/.smb_credentials 1username=&amp;lt;your user name&amp;gt; 2password=&amp;lt;your password&amp;gt; 4. change credential file permission for security reason 1chmod 600 /root/.smb_credentials 5. configure /etc/fstab 1sudo vi /etc/fstab 6. put next line into /etc/fstab. add noauto to options if you don&amp;rsquo;t want to let Ubuntu auto mount this path 1#&amp;lt;shared path&amp;gt; &amp;lt;mount point&amp;gt; &amp;lt;type&amp;gt; &amp;lt;options&amp;gt; 2//192.</description></item><item><title>Ubuntu Vnc</title><link>https://travisbikkle.github.io/zh-hant/2023/04/ubuntu-vnc/</link><pubDate>Mon, 10 Apr 2023 11:24:31 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/04/ubuntu-vnc/</guid><description>本文基於 Ubuntu 20.04 編寫。
安裝 vncserver 和要使用的桌面管理器 xfce 1apt install tightvncserver xfce4 xfce4-goodies 更改密碼 1vncpasswd 配置 vnc 以便客戶端連接時使用 xfce 桌面 編輯 ~/.vnc/xstartup，輸入以下內容 1#!/bin/sh 2unset SESSION_MANAGER 3unset DBUS_SESSION_BUS_ADDRESS 4startxfce4 &amp;amp; 執行以下命令 1chmod +x ~/.vnc/xstartup 禁用休眠 1systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target 啓動服務器 1vncserver -localhost no -geometry 1920x1080 參考 https://linuxconfig.org/vnc-server-on-ubuntu-20-04-focal-fossa-linux</description></item><item><title>端口轉發的一些方法</title><link>https://travisbikkle.github.io/zh-hant/2023/02/port-forward/</link><pubDate>Wed, 01 Feb 2023 11:24:24 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2023/02/port-forward/</guid><description>在《如何抓包分析 vrrp 報文是否中斷》中我們使用了 iptables 進行指定協議的報文日誌記錄功能，此處新增一個好用的命令。
我們在開發過程中，可能經常需要經過堡壘機、跳板機等中轉一次，才能訪問到處於小網中的服務，如數據庫。使用以下命令，可以在不借助第三方軟件的情況下，完成端口轉發，實現直連小網服務。
iptables 假設 192.168.1.3 是你的小網機器，端口是 15432
1iptables -t nat -A PREROUTING -p tcp --dport 15432 -j DNAT --to-destination 192.168.1.3:15432 2iptables -t nat -A POSTROUTING -p tcp -m tcp --dport 15432 -j MASQUERADE nginx upstream 192.168.1.3 { server 192.168.1.3:15432; } server { listen 15432; proxy_pass 192.168.1.3; proxy_connect_timeout 1h; proxy_timeout 1h; } 或者用 go 自己寫了一些小工具來轉發，我自己還寫了一個自動生成 xshell 配置的工具，因爲在公司內網，不便共享。</description></item><item><title>vrrp 報文抓包的方法</title><link>https://travisbikkle.github.io/zh-hant/2022/02/vrrp-cap/</link><pubDate>Tue, 01 Feb 2022 11:24:24 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2022/02/vrrp-cap/</guid><description>keepalived 的主機和備機，會每隔3s通過單播，向對方發送 vrrp 報文，當備機在 3次*每次心跳間隔（keepalived.conf中的adver_int參數） 都收不到主機的廣播，自己將會升主。
以下兩種可能都會存在：
主機沒有發送廣播 主機發送了廣播，備機沒有收到 因此，在主備都需要監控vrrp的發送（out）或接收（in）記錄。 使用以下兩種方式，都可以監控每次 vrrp 報文的內容，以便定位問題。
iptables 在主機和備機都添加監控vrrp發送和接收的iptables日誌（該規則僅抓取vrrp行爲，沒有其它副作用） 1iptables -t raw -A PREROUTING -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; 2iptables -t raw -A OUTPUT -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; 使用以下命令檢測是否添加成功： 1iptables -L -t raw -n 在/var/log/messages可以查看vrrp的記錄。如果是suse或其它操作系統，該日誌中沒有vrrp記錄的話，可以在dmesg或者/var/log/的目錄中grep VRRP查看。 定位完問題後，執行以下命令刪除添加的iptables規則 1iptables -t raw -D PREROUTING -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; 2iptables -t raw -D OUTPUT -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; tcpdump wireshark tcpdump 命令需要自行獲取，wireshark 需要自行下載，這部分僅記錄常用命令和注意點，由於在公司內網，圖片無法放上來。</description></item><item><title>一個數據庫主備頻繁切換案例</title><link>https://travisbikkle.github.io/zh-hant/2022/01/a-case-of-database-switch/</link><pubDate>Thu, 20 Jan 2022 11:24:25 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2022/01/a-case-of-database-switch/</guid><description>問題現象 某集團某局點分別部署了某數據庫的主備實例，業務發現偶爾訪問數據庫報錯。
定位結論 其中一個節點使用的某物理機型，網卡存在故障，發生了多次復位，致使某數據庫備機的keepalived雙機軟件接收不到對端的vrrp信號，備機在網卡復位期間短暫升主，兩臺機器都出現了vip，導致業務訪問某數據庫失敗。
需要聯繫廠商，針對以下疑問給出答覆：
節點A（某品牌F）和節點B（某品牌L）使用的網卡型號一樣，但是爲什麼某品牌F的固件版本要比某品牌L的新？
某品牌L的網卡信息，和某品牌L官網該型號的機器的認證信息不一致，見下表。
表1-1 某品牌F機型、某品牌L機型和某品牌L官網認證信息對比
項目 節點A 節點B 某品牌L官網認證信息 服務器型號 某品牌F FiberHome R2200 V5 某品牌L Inspur NF8480M5 某品牌L Inspur NF8480M5 網卡驅動 ixgbe 5.1.0-k ixgbe 5.1.0-k igb.ko 5.6.0-k 網卡固件 0x800006da 1.1824.0 0x800003df - 是否發生過重啓 否 是 - 定位過程 查看兩個節點的keepalived日誌
1cd /xx/xx/xx/logs 2zgrep Entering keepalived* 發現主機（節點A）上無異常，備機的keepalived在master、backup、fault三個狀態頻繁切換。
當keepalived進入master狀態，會將vip綁定到網卡上。這樣主機和備機都有vip，業務訪問某數據庫將會出現問題。
在備機上使用如下命令可以抓到短暫出現的vip：
1while true;do ip a s bond1|grep x.x.x.x;sleep 0.2;done 查看備機的keepalived.log，發現備機無法接收到主機的vrrp廣播。
keepalived的主備機都會每3s發送一次vrrp協議的廣播，當備機連續3次（9s）接收不到主機的廣播，就會將自己升主。
查看主機的keepalived.log，發現主機在正常發送vrrp廣播。
使用tcpdump在主機和備機同時抓包，問題復現後，發現主機確實發送了vrrp的廣播，但是備機在(15:46:14-15:46:32)有18s的時間沒有接收到任何來自主機的廣播（此處應該有圖，但是不放了）。
使用如下命令，查看備機上keepalived接收vrrp廣播的網卡情況，發現是一張由eth4和eth8組成的active-backup模式的邏輯網卡，：
1cat /proc/net/bonding/bond1 查看/var/log/messages中兩張物理網卡的信息，發現eth4和eth8網卡發生了多次復位，復位時間和gauss-datacube出現異常的時間能夠對應的上（此處應該有圖，但是不放了）。
查看節點B的服務器型號及網卡型號、固件版本（此處應該有圖，但是不放了）。 節點B和節點A對比，發現節點A的這臺某品牌F機型，比節點B的某品牌L機型使用的網卡固件要更新： 節點B和某品牌L官網認證信息(https://www.suse.com/nbswebapp/yesBulletin.jsp?bulletinNumber=148996)對比，發現節點B節點使用的網卡driver name和認證信息不符： 除了某局點節點B的某品牌L機型節點，我們還在其它局點的appdb的節點的某品牌L機型上，也發現了網卡重啓的現象，該現象在某品牌F機型上未發現，判斷是某品牌L的這批機器網卡存在故障。 這種短暫網卡重啓的問題，由於tcp重連的特性，對於普通的應用感知不大，但是對於數據庫這樣包含雙機軟件的敏感應用，影響較大。</description></item><item><title>Blktrace</title><link>https://travisbikkle.github.io/zh-hant/2021/04/blktrace/</link><pubDate>Mon, 19 Apr 2021 11:24:25 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2021/04/blktrace/</guid><description>可以用來定位 I/O 性能問題的工具有很多。常見的有 fio, dd, atop, iotop, iostat, vmstat 等。vmstat 可以提供系統性能的一個概覽，一般可以看出來性能問題究竟是不是 I/O 的鍋。想要具體查看每個設備的 I/O 情況，如 average request size, reads or writes per second，可以使用 iostat。
blktrace 介紹 更細粒度的分析，可以使用 blktrace。 blktrace 可以記錄在 I/O 棧的多個階段分別耗時多少。blktrace 的輸出結果是二進制文件，可以用 blkparse 解析，但是它仍然很難讀，需要使用 btt 來進一步轉換成更易讀的形式。
btt 輸出結果涉及到的一些基礎知識 btt 會對 I/O 棧 的不同階段的耗時做分析，這些階段是指：
Q — A block I/O is Queued G — Get Request M — A block I/O is Merged with an existing request. I — A request is Inserted into the device&amp;#39;s queue.</description></item><item><title>npm 鏡像等設置</title><link>https://travisbikkle.github.io/zh-hant/2018/10/common-pakage-manager-proxy/</link><pubDate>Sat, 13 Oct 2018 11:24:31 +0800</pubDate><guid>https://travisbikkle.github.io/zh-hant/2018/10/common-pakage-manager-proxy/</guid><description>中國加速鏡像 npm可能未及時同步 pip可能未同步官方已經刪除的惡意軟件包 manager useful commands command pnpm pnpm get registry pnpm config set registry https://registry.npmmirror.com npm npm get registry npm config set registry https://registry.npmmirror.com yarn yarn config get registry yarn config set registry https://registry.npmmirror.com pip pip config list # for pip install
pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/
# for pip search
pip config set global.index https://mirrors.aliyun.com/pypi
pip config set global.trusted-host mirrors.aliyun.com 代理 注意如果你沒有翻牆軟件就不用做下面的配置，請將地址修改爲你實際的代理地址。
npm(~/.npmrc)
1proxy=http://localhost:8118 2https_proxy=https://localhost:8118 3strict-ssl=false yarn(~/.yarnrc)
1env: 2 proxy &amp;#39;http://localhost:8118&amp;#39; 3 https_proxy &amp;#39;https://localhost:8118&amp;#39; 4 strict-ssl false</description></item></channel></rss>