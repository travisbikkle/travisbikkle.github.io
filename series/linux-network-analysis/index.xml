<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux NetWork Analysis on 奇风岁月</title><link>https://travisbikkle.github.io/series/linux-network-analysis/</link><description>Recent content in Linux NetWork Analysis on 奇风岁月</description><generator>Hugo -- gohugo.io</generator><language>zh-hans</language><copyright>Copyright © 2022-{year} Travis Bikkle. All Rights Reserved.</copyright><lastBuildDate>Wed, 01 Feb 2023 11:24:24 +0800</lastBuildDate><atom:link href="https://travisbikkle.github.io/series/linux-network-analysis/index.xml" rel="self" type="application/rss+xml"/><item><title>端口转发的一些方法</title><link>https://travisbikkle.github.io/2023/02/port-forward/</link><pubDate>Wed, 01 Feb 2023 11:24:24 +0800</pubDate><guid>https://travisbikkle.github.io/2023/02/port-forward/</guid><description>在《如何抓包分析 vrrp 报文是否中断》中我们使用了 iptables 进行指定协议的报文日志记录功能，此处新增一个好用的命令。
我们在开发过程中，可能经常需要经过堡垒机、跳板机等中转一次，才能访问到处于小网中的服务，如数据库。使用以下命令，可以在不借助第三方软件的情况下，完成端口转发，实现直连小网服务。
iptables 假设 192.168.1.3 是你的小网机器，端口是 15432
1iptables -t nat -A PREROUTING -p tcp --dport 15432 -j DNAT --to-destination 192.168.1.3:15432 2iptables -t nat -A POSTROUTING -p tcp -m tcp --dport 15432 -j MASQUERADE nginx upstream 192.168.1.3 { server 192.168.1.3:15432; } server { listen 15432; proxy_pass 192.168.1.3; proxy_connect_timeout 1h; proxy_timeout 1h; } 或者用 go 自己写了一些小工具来转发，我自己还写了一个自动生成 xshell 配置的工具，因为在公司内网，不便共享。</description></item><item><title>vrrp 报文抓包的方法</title><link>https://travisbikkle.github.io/2022/02/vrrp-cap/</link><pubDate>Tue, 01 Feb 2022 11:24:24 +0800</pubDate><guid>https://travisbikkle.github.io/2022/02/vrrp-cap/</guid><description>keepalived 的主机和备机，会每隔3s通过单播，向对方发送 vrrp 报文，当备机在 3次*每次心跳间隔（keepalived.conf中的adver_int参数） 都收不到主机的广播，自己将会升主。
以下两种可能都会存在：
主机没有发送广播 主机发送了广播，备机没有收到 因此，在主备都需要监控vrrp的发送（out）或接收（in）记录。 使用以下两种方式，都可以监控每次 vrrp 报文的内容，以便定位问题。
iptables 在主机和备机都添加监控vrrp发送和接收的iptables日志（该规则仅抓取vrrp行为，没有其它副作用） 1iptables -t raw -A PREROUTING -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; 2iptables -t raw -A OUTPUT -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; 使用以下命令检测是否添加成功： 1iptables -L -t raw -n 在/var/log/messages可以查看vrrp的记录。如果是suse或其它操作系统，该日志中没有vrrp记录的话，可以在dmesg或者/var/log/的目录中grep VRRP查看。 定位完问题后，执行以下命令删除添加的iptables规则 1iptables -t raw -D PREROUTING -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; 2iptables -t raw -D OUTPUT -p vrrp -j LOG --log-level 6 --log-prefix &amp;#34;VRRP: &amp;#34; tcpdump wireshark tcpdump 命令需要自行获取，wireshark 需要自行下载，这部分仅记录常用命令和注意点，由于在公司内网，图片无法放上来。</description></item></channel></rss>